<!DOCTYPE html>
<html style="height: 100%;width: 100%;">
    <head>
        <meta charset="utf-8">
        <title>tag生成</title>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://myproj.obs.cn-east-3.myhuaweicloud.com/NovelaiTag/data.js"></script>
    </head>
    <body style="height: 100%;width: 100%;display: inline-block;overflow: hidden;background-color: white;">
        <div id="inputarea" style="display: block;width: 100%;height: 78%;overflow: hidden;">
            <div style="display: inline-block;width: 20%;height: 100%;overflow: hidden;">
                <div id="presetarea" class="selectarea" style="display: block;width: 100%;height: 66%;">
                    <label >预设tag</label>
                    <div class="selectareain" style="display: inline-flex;width: 100%;height: 94%;">
                        <div class="selectblock" style="width: 30%;height: 100%;">
                            <div class="selectbox" style="width: 100%;height: 92%;border-bottom: 1px;border-style: solid;">
                            </div>
                            <button class="applyall" style="display: block;width: 100%;height: 8%;">采用此预设</button>
                        </div>
                        <div class="selectblock" style="width: 65%;height: 100%;border-left: 0px;">
                            <div class="tagbox" style="width: 100%;height: 100%;">
                            </div>
                        </div>
                    </div>
                </div>
                <div id="optimizerarea" class="selectarea" style="display: block;width: 100%;height: 32%;">
                    <label >优化tag</label>
                    <div class="selectareain" style="display: inline-flex;width: 100%;height: 90%;">
                        <div class="selectblock" style="width: 30%;height: 100%;">
                            <div class="selectbox" style="width: 100%;height: 85%;border-bottom: 1px;border-style: solid;">
                            </div>
                            <button class="applyall" style="display: block;width: 100%;height: 15%;">采用此预设</button>
                        </div>
                        <div class="selectblock" style="width: 65%;height: 100%;border-left: 0px;">
                            <div class="tagbox" style="width: 100%;height: 100%;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="display: inline-block;width: 20%;height: 100%;overflow: hidden;">
                <div id="featurearea" class="selectarea" style="display: block;width: 100%;height: 50%;">
                    <label >特征tag</label>
                    <div class="selectareain" style="display: inline-flex;width: 100%;height: 90%;">
                        <div class="selectblock" style="width: 30%;height: 100%;">
                            <div class="selectbox" style="width: 100%;height: 100%;">
                            </div>
                        </div>
                        <div class="selectblock" style="width: 65%;height: 100%;border-left: 0px;">
                            <div class="tagbox" style="width: 100%;height: 100%;">
                            </div>
                        </div>
                    </div>
                </div>
                <div id="compositionarea" class="selectarea" style="display: block;width: 100%;height: 50%;">
                    <label >场景构图tag</label>
                    <div class="selectareain" style="display: inline-flex;width: 100%;height: 90%;">
                        <div class="selectblock" style="width: 30%;height: 100%;">
                            <div class="selectbox" style="width: 100%;height: 100%;">
                            </div>
                        </div>
                        <div class="selectblock" style="width: 65%;height: 100%;border-left: 0px;">
                            <div class="tagbox" style="width: 100%;height: 100%;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="display: inline-block;width: 20%;height: 100%;overflow: hidden;">
                <div id="negativearea" class="selectarea" style="display: block;width: 100%;height: 66%;">
                    <label >负面tag组</label>
                    <div class="selectareain" style="display: inline-flex;width: 100%;height: 94%;">
                        <div class="selectblock" style="width: 30%;height: 100%;">
                            <div class="selectbox" style="width: 100%;height: 92%;border-bottom: 1px;border-style: solid;">
                            </div>
                            <button class="applyall" style="display: block;width: 100%;height: 8%;">采用此预设</button>
                        </div>
                        <div class="selectblock" style="width: 65%;height: 100%;border-left: 0px;">
                            <div class="tagbox" style="width: 100%;height: 100%;">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="randomarea" class="selectarea" style="display: block;width: 100%;height: 32%;">
                    <label >随机tag</label>
                    <div class="selectareain" style="display: inline-flex;width: 100%;height: 90%;">
                        <div class="selectblock" style="width: 30%;height: 100%;">
                            <div class="selectbox" style="width: 100%;height: 80%;border-bottom: 1px;border-style: solid;">
                                <p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p>
                            </div>
                            <button style="display: block;width: 100%;height: 10%;">随机生成</button>
                            <button class="applyall" onclick="random_click()" style="display: block;width: 100%;height: 10%;">应用</button>
                        </div>
                        <div class="selectblock" style="width: 65%;height: 100%;border-left: 0px;">
                            <div class="tagbox" style="width: 100%;height: 100%;">
                                <p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p><p>未完成</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="display: inline-block;width: 19%;height: 100%;overflow: hidden;">
                <div id="positiveresultarea" class="selectarea" style="display: inline-block;width: 100%;height: 100%;">
                    <label >结果</label>
                    <div class="selectareain" style="display: inline-flex;width: 100%;height: 95%;">
                        <div class="selectblock" style="width: 100%;height: 100%;">
                            <div class="tagbox" style="display: blcok;width: 100%;height: 95%;border-bottom: 1px;border-style: solid;">
                            </div>
                            <div style="display: inline-flex;width: 100%;height: 5%;font-size: 0px;">
                                <button onclick="diyresult(0)" style="display: inline-block;width: 25%;height: 100%;">+</button>
                                <button onclick="applyresult(0)" style="display: inline-block;width: 50%;height: 100%;">应用</button>
                                <button onclick="cleanresult(0)" style="display: inline-block;width: 25%;height: 100%;">清空</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="display: inline-block;width: 19%;height: 100%;overflow: hidden;">
                <div id="negativeresultarea" class="selectarea" style="display: inline-block;width: 100%;height: 100%;">
                    <label >负面tag</label>
                    <div class="selectareain" style="display: inline-flex;width: 100%;height: 95%;">
                        <div class="selectblock" style="width: 100%;height: 100%;">
                            <div class="tagbox" style="width: 100%;height: 95%;border-bottom: 1px;border-style: solid;">
                            </div>
                            <div style="display: inline-flex;width: 100%;height: 5%;font-size: 0px;">
                                <button onclick="diyresult(1)" style="display: inline-block;width: 25%;height: 100%;">+</button>
                                <button onclick="applyresult(1)" style="display: inline-block;width: 50%;height: 100%;">应用</button>
                                <button onclick="cleanresult(1)" style="display: inline-block;width: 25%;height: 100%;">清空</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="outputarea" style="display: block;width: 100%;height: 18%;overflow: hidden;">
            <div style="display: inline-block;overflow: hidden;border: 1px;border-color: black;border-style: solid;width: 50%;height: 99%;">
                <textarea id="positiveoutput" class="output" placeholder="正面tag"></textarea>
            </div>
            <div style="display: inline-block;overflow: hidden;border: 1px;border-color: black;border-style: solid;width: 49%;height: 99%;">
                <textarea id="negativeoutput"  class="output"  placeholder="负面tag"></textarea>
            </div>
        </div>
        <div id="tagunitform" class="tagunit" style="display: block;">
            <div  style="display: inline-flex;width:100%;height: 25pt;font-size: 0px;border-width: 0.5px;border-color: gainsboro;background-color: white;padding: 0px;border-style: solid;">
                <button onclick="tagsetting(this)" class="tagarea tagbtn" type="button" class="tagbtn tagsetting" style="width: 7%;height: 100%;">∷</button>
                <button onclick="tagpos(this,10)" class="tagarea tagbtn" type="button" class="tagbtn tagtop" style="width: 7%;height: 100%;">▲</button>
                <div class="tagarea" style="width: 7%;height: 100%;">
                    <button onclick="taglevel(this,1)" type="button" class="tagbtn taglevelup" style="width: 100%;height: 50%;"><a>+</a></button>
                    <button onclick="taglevel(this,-1)" type="button" class="tagbtn tagleveldown" style="width: 100%;height: 50%;"><a>-</a></button>
                </div>
                <div class="tagarea tagtextarea" style="display: inline-block;width: 58%;height: 100%;margin: 0%;font-size: 11pt;position: relative;">
                    <div class="tagtext" style="width: 100%;position: absolute;top: 50%;transform: translate(0, -50%);overflow-x:scroll;">tag_text</div>
                </div>
                <div class="tagarea" style="width: 7%;height: 100%;">
                    <button onclick="tagpos(this,1)" type="button" class="tagbtn tagposup" style="width: 100%;height: 50%;"><a>△</a></button>
                    <button onclick="tagpos(this,-1)" type="button" class="tagbtn tagposdown" style="width: 100%;height: 50%;"><a>▽</a></button>
                </div>
                <button onclick="tagpos(this,-10)" class="tagarea tagbtn" type="button tagbottom" class="tagbtn" style="width: 7%;height: 100%;">▼</button>
                <button onclick="tagdelete(this)" class="tagarea tagbtn" type="button tagdelete" class="tagbtn" style="width: 7%;height: 100%;">X</button>
            </div>
        </div>
        <div id="tagsettingwindow" class="setwindow">
            <div style="width: 97%;height: 5%;text-align: right;margin-top: 2%;margin-bottom: 2%;">
                <button onclick="hidesetwindow()" class="tagbtn" style="width: 5%;height: 100%;text-align: center;" type="button">X</button>
            </div>
            <textarea id="tagsettext" style="width: 94%;height: 20%;font-size: 13pt;"></textarea>
            <div id="modificationarea" class="selectarea" style="display: block;width: 100%;height: 60%;margin-bottom: 2%;">
                <div class="selectareain" style="display: inline-flex;width: 95%;height: 100%;">
                    <div class="selectblock" style="width: 30%;height: 100%;">
                        <div class="selectbox" style="width: 100%;height: 100%;">
                        </div>
                    </div>
                    <div class="selectblock" style="width: 70%;height: 100%;border-left: 0px;">
                        <div class="tagbox" style="width: 100%;height: 100%;">
                        </div>
                    </div>
                </div>
            </div>
            <button onclick="applytagset()" id="tagsetapply" style="width: 50%;height: 5%;" type="button" area="" index="">应用</button>
        </div>
    </body>
    <style>
        .selectblock {display: inline-block;border: 1px;border-color: black;border-style: solid;}
        .selectbox {display: block;border: 0px;border-color: black;border-style: solid;overflow-y: scroll;}
        .tagbox {display: block;border: 0px;border-color: black;border-style: solid;overflow-y: scroll;overflow-x: hidden;}
        .tagarea {display: inline-block;margin: 0px;padding: 0px;}
        .tagtext {white-space:nowrap;}
        .tagbtn {margin: 0px;padding:0px;display: inline-block;border-radius: 0px;border-width: 0.5px;background-color: white;border-color: gainsboro;}
        .tagbtn:hover {background-color: gainsboro;}
        .tagbtn:active {background-color: gray;}
        .tagclick {width: 100%;height: 25pt;overflow-x: scroll;position: relative;text-align: left;border-radius: 0px;border-width: 0.5px;background-color: white;border-style: solid;border-color: gainsboro;}
        .tagclick:hover {background-color: gainsboro;}
        .tagclick:active {background-color: gray;}
        .selectbox .active {background-color: rgb(114, 114, 252);}
        .tagclicktext {display: block;white-space:nowrap;position: absolute;top: 50%;transform: translate(0, -50%);}
        .selectblock  button {border-radius: 0px;border-width: 0.5px;border-color: white;}
        .selectblock  button:hover {background-color: rgb(202, 202, 202);}
        .selectblock  button:active {background-color: hsl(0, 0%, 62%)}
        .output {display: block;width: 100%;height: 100%;font-size: 13pt;}
        .setwindow { text-align: center;position: absolute; top: 25%; left: 35%; width: 30%; height: 55%;border-width: 2px;background-color: white;border-color: gainsboro;border-style: solid;border-radius: 20px; }
        ::-webkit-scrollbar {display: none; /* Chrome Safari */}
    </style>
    <script>
        tagmodel={
            'name':'',
            'level':'',
            'note':'',
            'class':'',
            'mod':['','']
        }

        selectareas={
            'optimizer':{},
            'feature':{},
            'composition':{},
            'preset':{},
            'negative':{},
            'modification':{}
        }

        resultnum={
            'positive':'',
            'negative':''
        }

    function getCharCount(str,keyWord) {
        let sumNum=0;
        if(str){
           let arr=str.split(keyWord);
                sumNum=arr.length-1;
        }
        return sumNum
    }

    function getContentInside(text,left,right){
        var regextext = "/(?<=\\"+left+")([^"+left+right+"]+)(?=\\"+right+")/g";
        var regex = eval(regextext);
        return text.match(regex);
    }

    function gettaginfo(tagtext){
        var tagtext=tagtext;
        var tag={};
        if (getCharCount(tagtext,'#')>0){
            var sp=tagtext.split('#');
            tagtext=sp[0];
            tag['note']=sp[1];
        }
        var level=0;
        var name=tagtext;
        if (getCharCount(tagtext,':')>0){
            level=(getContentInside(tagtext,':',')')-1)*20;
            var left=0,right=tagtext.length;
            for (i in tagtext){
                if (tagtext[i]=='{') {left+=1;}
                else if (tagtext[i]=='[') {left+=1;}
                else if (tagtext[i]=='(') {left+=1;}
                else if (tagtext[i]==' ') {left+=1;}
                else break;
            }
            for (i in tagtext){if (tagtext[i]==':') {right=i;}}
            name=tagtext.substring(left,right);
        } 
        else{
            var left=0,right=tagtext.length;
            for (i in tagtext){
                if (tagtext[i]=='{') {level+=1;left+=1;right-=1;}
                else if (tagtext[i]=='[') {level-=1;left+=1;right-=1;}
                else if (tagtext[i]=='(') {level+=2;left+=1;right-=1;}
                else if (tagtext[i]==' ') {left+=1;}
                else break;
            }
            name=tagtext.substring(left,right);
        }
        let namestr=name.toString();
        words=namestr.split(' ');
        var mod=[];
        if (words.length>1){
            for (modlist in data['modification']){
                for (i in data['modification'][modlist]){
                    var temp=data['modification'][modlist][i];
                    if (words.includes(temp)){
                        mod.push(temp);
                        words.splice(words.indexOf(temp),1)
                    }
                }
            }
            namestr=words2tag(words,' ');
            if (namestr=='') namestr=name.toString();
        }
        tag['name']=namestr;
        tag['level']=level;
        tag['mod']=mod;
        // console.log(tag);
        return tag;
    }

    function words2tag(words,separator){
        tag="";
        len=words.length;
        if(len<1) return tag;
        tag+=words[0];
        for (var i=1;i<len;i++){
            tag+=separator+words[i];
        }
        return tag;
    }

    function getrealtag(tag){
        var level=tag['level'];
        var name=tag['name'];
        var mod=tag['mod'];
        var tagtext=name;
        if (mod.length>0){
            mod.push(name);
            tagtext=words2tag(mod,' ');
        }
        var symb=['{','}','{{','}}','{{{','}}}','((','))'];
        if (level==0) return tagtext;
        if (level<0) {
            for (var i=0;i>level;i--) tagtext='['+tagtext+']';
            return tagtext;
        }
        if (level>0&&level<5) tagtext=symb[level*2-2]+name+symb[level*2-1];
        else tagtext='('+name+':'+(level/20+1.0).toFixed(2)+')';
        return tagtext;
    }

    function onflush(area){
        $('#'+area+"area .tagbox .tagclick").bind("contextmenu", function(){
            return false;
        })

        $('#'+area+"area .tagbox .tagclick").mousedown(function(e) {
            if (e.which == 1) {
                tagclick($(this),0);
            }else if (e.which == 3){
                tagclick($(this),1);
            }
        })
    }

    function updateactive(boxarea){
        $("#"+boxarea+"area .selectbox .tagclick").removeClass("active");
        $("#"+boxarea+"area .selectbox .tagclick").each(function(i, item){
            if ($(item).children().html()==selectareas[boxarea]['selecton']){
                $(item).addClass('active');
            }
        })
        flushBox(boxarea,"tagbox","tagclick",data[boxarea][selectareas[boxarea]['selecton']]);
    }

    function addButton(boxarea,boxtype,item){
        var buttontml="<div class='tagclick' style='display: block;' area="+boxarea+"><div class='tagclicktext'>"+item+"</div></div>"
        return $("#"+boxarea+"area ."+boxtype).html()+buttontml;
    }

    function flushBox(boxarea,boxtype,unittype,itemlist){
        if (unittype=="tagunit"){
            var unit=$("#tagunitform");
            for (i in itemlist){
                var cpunit=unit.clone(true);
                // $("#resultarea .tagbox").appendChild(cpunit);
                $(cpunit).removeAttr('id');
                $(cpunit).find(".tagtext").html(itemlist[i]);
                $(cpunit).appendTo($("#"+boxarea+"area ."+boxtype))
                cpunit.show();
            }
        }else{
            if (boxtype=='selectbox'){
                $("#"+boxarea+"area ."+boxtype).html("");
                for (item in itemlist){
                    $("#"+boxarea+"area ."+boxtype).html(addButton(boxarea,boxtype,itemlist[item]));
                }
                updateactive(boxarea);
            }else if (boxtype=='tagbox'){
                var itemlist=itemlist;
                if((typeof itemlist)=="string"){
                    itemlist=itemlist.split(',');
                }
                selectareas[boxarea]['taglist']=[];
                $("#"+boxarea+"area ."+boxtype).html("");
                for (item in itemlist){
                    itemtext=getrealtag(gettaginfo(itemlist[item]));
                    $("#"+boxarea+"area ."+boxtype).html(addButton(boxarea,boxtype,itemtext));
                    selectareas[boxarea]['taglist'].push(itemtext);
                }
            }
            
        }
    }

    

    function initSelectBox(selectid) {
        selectlist=Object.keys(data[selectid]);
        selectareas[selectid]['selecton']=selectlist[0];
        flushBox(selectid,'selectbox','selectclick',itemlist=selectlist);
    }

    function select_click(item){
        if (item.children().html()!=selectareas[item.attr('area')]['selecton']){
            selectareas[item.attr('area')]['selecton']=item.children().html();
            updateactive(item.attr('area'));
            onflush(item.attr('area'));
        }
    }

    function add_text_to_result(text,type,area){
        if (text=="random") {
            random_add(area,selectareas[area]['selecton']);
            return;
        }
        var tag=gettaginfo(text);
        var tagtext=getrealtag(tag);
        var typetext=(type==0)? "positive":"negative";
        if (area=="negative") typetext=(type==1)? "positive":"negative";
        flushBox(typetext+"result","tagbox","tagunit",[tagtext]);
    }

    function tagclick(item,type){
        if (item.attr('area')!="modification") add_text_to_result(item.children().html(),type,item.attr('area'));
        else {
            add_mod_to_tag(item.children().html());
        }
    }

    function applyallclick(item,type){
        var areaid=item.parents(".selectarea").attr("id");
        var area=areaid.substring(0,areaid.length-4);
        taglist=selectareas[area]['taglist'];
        for (i in taglist){
            add_text_to_result(taglist[i],type,area);
        }
    }

    function applyresult(type){
        var typetext=(type==0)? "positive":"negative";
        var tags=[];
        $("#"+typetext+"resultarea .tagtext").each(function(i, item){
            tags.push($(item).html());
        })
        var output=words2tag(tags,',');
        // console.log(tags,output);
        $("#"+typetext+"output").val(output);
    }

    function cleanresult(type){
        var typetext=(type==0)? "positive":"negative";
        $("#"+typetext+"resultarea .tagbox").html("");
    }

    function diyresult(type){
        var typetext=(type==0)? "positive":"negative";
        $("#tagsetapply").attr("area",typetext);
        $("#tagsetapply").attr("index",-1);
        $('#tagsettingwindow').show();
    }

    function add_mod_to_tag(text){
        var tagtext=$("#tagsettext").val();
        var tag=gettaginfo(tagtext);
        console.log(tag);
        tag['mod'].push(text);
        tagtext=getrealtag(tag);
        $("#tagsettext").val(tagtext);
    }

    function tagsetting(obj){
        unit=$(obj).parents(".tagunit");
        index=unit.parent().children().index(unit);
        $("#tagsettext").val(unit.find(".tagtext").html());
        var areaid=unit.parents(".selectarea").attr("id");
        var area=areaid.substring(0,areaid.length-10);
        $("#tagsetapply").attr("area",area);
        $("#tagsetapply").attr("index",index);
        $('#tagsettingwindow').show();
    }

    function hidesetwindow(){
        $("#tagsettext").val("");
        $("#tagsetapply").attr("area","");
        $("#tagsetapply").attr("index","");
        $('#tagsettingwindow').hide();
    }

    function applytagset(){
        var area=$("#tagsetapply").attr("area");
        var index=$("#tagsetapply").attr("index");
        var tagtext=$("#tagsettext").val();
        if (index>=0){
            $("#"+area+"resultarea .tagunit:eq("+index+")").find(".tagtext").html(tagtext);
        }else{
            var type=(area=="positive")? 0:1;
            add_text_to_result(tagtext,type,"diy");
        }
        hidesetwindow();
    }

    function tagpos(obj,offset){
        unit=$(obj).parents(".tagunit");
        index=unit.parent().children().index(unit);
        var soff=unit.offset().top;
        if(offset>0){
            if (offset<=5){targetindex=index-offset;}
                else{targetindex=0;}
                unit.insertBefore(unit.parent().children(".tagunit:eq("+targetindex+")"));
            }else{
                if (offset>=-5){targetindex=index-offset;}
                else{targetindex=unit.parent().children().length-1}
                unit.insertAfter(unit.parent().children(".tagunit:eq("+targetindex+")"));
        }
        soff=unit.offset().top-soff;
        soff=unit.parent().scrollTop()+soff;
        unit.parent().scrollTop(soff);
    }

    function taglevel(obj,offset){
        var unit=$(obj).parents(".tagunit");
        var tagtext=unit.find(".tagtext").html();
        tag=gettaginfo(tagtext);
        tag['level']=tag['level']+offset;
        tagtext=getrealtag(tag);
        unit.find(".tagtext").html(tagtext);
    }

    function tagdelete(obj){
        unit=$(obj).parents(".tagunit");
        unit.remove();
    }


    function genRandomtags(itemlist){
        var taglist=[];
        for (i in itemlist){
            if (data['composition'][itemlist[i]]!=null){
                var arr=data['composition'][itemlist[i]];
                var index = Math.floor((Math.random()*arr.length));
                taglist.push(getrealtag(arr[index]));
            }
            if (data['feature'][itemlist[i]]!=null){
                var arr=data['feature'][itemlist[i]];
                var index = Math.floor((Math.random()*(arr.length-1)))+1;
                if (index<arr.length) taglist.push(getrealtag(arr[index]));
                
            }
        }
        return taglist;
    }

    function random_add(area,type){
        alert('Can not use yet!',area,type);
    }


    window.onload=function(){
        $('#tagunitform').hide();
        $('#tagsettingwindow').hide();
        for (area in selectareas) {
            initSelectBox(area,"selectbox","tagclick");
        }
        $(".selectbox .tagclick").click(function (){
            select_click($(this));
        })

        $(".tagbox .tagclick").bind("contextmenu", function(){
            return false;
        })

        $(".tagbox .tagclick").mousedown(function(e) {
            if (e.which == 1) {
                tagclick($(this),0);
            }else if (e.which == 3){
                tagclick($(this),1);
            }
        })

        $(".selectblock .applyall").bind("contextmenu", function(){
            return false;
        })

        $(".selectblock .applyall").mousedown(function(e) {
            if (e.which == 1) {
                applyallclick($(this),0);
            }else if (e.which == 3){
                applyallclick($(this),1);
            }
        })
    }
</script>
</html>